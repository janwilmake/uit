// Function to copy the markdown and navigate (called on button click)
function addBadgeToReadme() {
  const urlPath = window.location.pathname;
  const urlSearch = window.location.search;
  const urlParts = urlPath.split("/").filter(Boolean);
  const owner = urlParts[0];
  const repo = urlParts[1];
  const branch = urlParts[3] || "main";

  try {
    // Create a temporary textarea element
    const textarea = document.createElement("textarea");
    textarea.value = `[![${owner}/${repo} context](https://badge.forgithub.com${urlPath}${urlSearch})](https://uithub.com${urlPath}${urlSearch})`;

    // Make it non-editable and invisible
    textarea.setAttribute("readonly", "");
    textarea.style.position = "absolute";
    textarea.style.left = "-9999px";

    // Add it to the document, select and copy
    document.body.appendChild(textarea);
    textarea.focus();
    textarea.select();
    const successful = document.execCommand("copy");

    // Clean up
    document.body.removeChild(textarea);

    if (!successful) {
      throw new Error("Copy command failed");
    } else {
      alert("Copied.\n\nYou will now be redirected to edit the README.");
    }

    // Navigate to README edit page
    window.location.href = `https://github.com/${owner}/${repo}/edit/${branch}/README.md`;
  } catch (err) {
    console.error("Copy failed:", err);
    alert("Failed to copy badge. Please try again.");
  }
}

// Function to create a .genignore file in the repo (called on button click)
function addGenignore() {
  const urlPath = window.location.pathname;
  const urlSearch = window.location.search;
  const urlParts = urlPath.split("/").filter(Boolean);
  const owner = urlParts[0];
  const repo = urlParts[1];
  const branch = urlParts[3] || "main";

  try {
    // Get excluded paths from the current search
    const excludePatterns = new URLSearchParams(window.location.search).getAll(
      "excludePathPatterns",
    );

    if (excludePatterns.length === 0) {
      alert("Please add some exclude patterns first");
      return;
    }

    // Create the content for the .genignore file
    const genignoreContent = `# genignore generated by uithub.com`;

    // URL encode the content
    const encodedContent = encodeURIComponent(genignoreContent);

    // Navigate to create new file page with pre-populated content
    window.location.href = `https://github.com/${owner}/${repo}/new/${branch}?filename=.genignore&value=${encodedContent}`;
  } catch (err) {
    console.error("Navigation failed:", err);
    alert("Failed to create .genignore file. Please try again.");
  }
}
